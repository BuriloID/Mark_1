{% extends 'base.html' %}

{% block title%}
Каталог
{% endblock %}
{%block menu %}
    <div class="wrapper">
        <div class="menu">
            <i class="fa fa-bars fa-2x burger"></i>
            <nav class="menu_list">
                <ul>
                <li><a href="{{ url_for('catalog', category='women') }}" >Женщины</a>
                    <ul>
                        <li><a href="{{ url_for('catalog', name='Джемпер') }}">Джемперы</a></li>
                        <li><a href="{{ url_for('catalog', name='Свитер') }}">Свитеры</a></li>
                        <li><a href="{{ url_for('catalog', name='Кардиган') }}">Кардиганы</a></li>
                        <li><a href="{{ url_for('catalog', name='Костюм') }}">Костюмы</a></li>
                        <li><a href="{{ url_for('catalog', name='Юбка') }}">Юбки</a></li>
                        <li><a href="{{ url_for('catalog', name='Футболка') }}">Футболки и топы</a></li>
                    </ul>
                </li>
                <li><a href="{{ url_for('catalog', category='men') }}" >Мужчины</a>
                     <ul>
                        <li><a href="{{ url_for('catalog', name='Джемпер') }}">Джемперы</a></li>
                         <li><a href="{{ url_for('catalog', name='Свитер') }}">Свитеры</a></li>
                    </ul>
                </li>
                <li><a href="{{ url_for('catalog', category='acs') }}" >Аксесcуары</a>
                    <ul>
                        <li><a href="{{ url_for('catalog', name='Шарф') }}">Шарфы</a></li>
                        <li><a href="{{ url_for('catalog', name='Шапка') }}">Шапки</a></li>
                        <li><a href="{{ url_for('catalog', name='Палантин') }}">Палантины</a></li>
                    </ul>
                </li>
                <li><a href="{{url_for('sale')}}" >Распродажа</a></li>
                </ul>
            </nav>
        </div>
    </div>
{% endblock %}
{% block content %}

<form action="{{ url_for('catalog') }}" method="get" class="search-form">
    <input type="text" name="search" placeholder="Поиск по названию или описанию..." value="{{ request.args.get('search', '') }}">
    <button type="submit"><i class="fa fa-search"></i> Найти</button>
</form>
<div class="filter-drawer" id="filterDrawer">
        <div class="filter-content">
        <div class="filter-header">
            <h3>Фильтры</h3>
            <button class="close-filter" id="closeFilter">&times;</button>
        </div>
        
        <div class="filter-section">
            <h4>Цена, ₽</h4>
            <div class="price-inputs">
                <div class="price-input-group">
                    <label>От</label>
                    <input type="number" id="minPrice" placeholder="{{ real_min_price }}" min="{{ real_min_price }}" max="{{ real_max_price }}">
                </div>
                <div class="price-input-group">
                    <label>До</label>
                    <input type="number" id="maxPrice" placeholder="{{ real_max_price }}" min="{{ real_min_price }}" max="{{ real_max_price }}">
                </div>
            </div>
            <div class="price-slider-container">
                <div class="price-slider">
                    <div class="slider-track">
                        <div class="slider-range" id="sliderRange"></div>
                    </div>
                    <input type="range" id="minRange" min="{{ real_min_price }}" max="{{ real_max_price }}" value="{{ real_min_price }}" class="range-min">
                    <input type="range" id="maxRange" min="{{ real_min_price }}" max="{{ real_max_price }}" value="{{ real_max_price }}" class="range-max">
                </div>
            </div>
        </div>

<div class="filter-section">
    <h4>Состав</h4>

    <div class="composition-filter">
        {% for composition in compositions %}
        <div class="checkbox-wrapper">
            <input
                type="checkbox"
                class="check composition-checkbox"
                id="composition_{{ loop.index }}"
                name="composition"
                value="{{ composition }}"
            >

            <label for="composition_{{ loop.index }}" class="label">
                <svg width="30" height="30" viewBox="0 0 95 95">
                    <rect x="30" y="20" width="50" height="50"
                          stroke="black" fill="none"></rect>
                    <g transform="translate(0,-952.36222)">
                        <path
                            d="m 56,963 c -102,122 6,9 7,9 17,-5 -66,69 -38,52
                               122,-77 -7,14 18,4 29,-11 45,-43 23,-4"
                            stroke="black"
                            stroke-width="3"
                            fill="none"
                            class="path1">
                        </path>
                    </g>
                </svg>

                <span class="composition-name">{{ composition }}</span>
            </label>
        </div>
        {% else %}
        <p class="no-compositions">Состав не указан</p>
        {% endfor %}
    </div>
</div>

         <div class="filter-actions">
            <button class="apply-filter" id="applyFilter">Применить фильтры</button>
            <button class="reset-filter" id="resetFilter">Сбросить</button>
        </div>
            <p style="text-align:center; color:#777; margin-top:10px;">(Здесь появятся фильтры)</p>
        </div>
    </div>
    <div class="filter-handle" id="filterHandle">
        <div class="handle-container">
            <div class="handle-bar"></div>
        </div>
    </div>
    <div class="catalog-wrapper">
    <div id="productsCount" class="products-count">
        Найдено товаров: {{ products|length }}
    </div>
    </div>
    <div id="productsContainer" class="catalog">
        {% for product in products %}
            <div class="product">
                {% if product.__class__.__name__ == 'NewProduct' %}
            <div class="new-label">New</div>
        {% endif %}
    {% if product.image_url %}
        <img src="{{ url_for('static', filename=product.image_url) }}" alt="{{ product.name }}" class="main-img">
        <img src="{{ url_for('static', filename=product.image_url_back) }}" alt="{{ product.name }}" class="hover-img">
    {% else %}
        <img src="https://via.placeholder.com/150" alt="{{ product.name }}">
    {% endif %}
    <h2>{{ product.description }}</h2>
    <p>{{ product.name }}</p>
    <p><strong>{{ product.price | int }} ₽</strong></p>
        <a href="{{ url_for('product_detail', product_id=product.id, product_type='new_product' if product.__class__.__name__ == 'NewProduct' else 'product') }}">
            <button class="btn">Перейти</button>
        </a>
    </div>
        {% else %}
            <p>Товары не найдены</p>
        {% endfor %}
    </div>
    {% if pages > 1 %}
<nav class="pagination">
    {% if page > 1 %}
        <a href="{{ url_for('catalog', page=page-1, **args) }}">&laquo;</a>
    {% endif %}
    {% for p in range(1, pages+1) %}
        {% if p == page %}
            <span class="current">{{ p }}</span>
        {% else %}
            <a href="{{ url_for('catalog', page=p, **args) }}">{{ p }}</a>
        {% endif %}
    {% endfor %}
    {% if page < pages %}
        <a href="{{ url_for('catalog', page=page+1, **args) }}">&raquo;</a>
    {% endif %}
</nav>
{% endif %}
{% endblock %}