{% extends "base.html" %}

{% block title %}
    Корзина
{% endblock %}

{% block content %}
    <a href="javascript:history.back()" class="back-button">
        <i class="fa fa-arrow-left"></i> Назад
    </a>
    <h1>Ваша корзина</h1>
    {% if cart %}
        <ul class="cart-items">
            {% for product_id, item in cart.items() %}
                <li class="cart-item">
                    <img src="{{ url_for('static', filename=item.image_url) }}" alt="{{ item.name }}" class="cart-item-image">
                    <div class="cart-item-details">
                        <p class="cart-item-name">{{ item.name }} "{{ item.description }}"</p>
                        {% if item.sale %}
                        <p class="cart-item-price">
                        <span class="old-price">{{ item.price | int }} ₽</span> →
                        <span class="new-price">
                        {{ (item.price * (1 - item.sale / 100)) | round(0, 'floor') | int }} ₽
                        </span>
                        x {{ item.quantity }}
                        </p>
                        {% else %}
                        <p class="cart-item-price">{{ item.price | int }} ₽ x {{ item.quantity }}</p>
                        {% endif %}
                    </div>
                    <a href="{{ url_for('remove_from_cart', product_id=product_id) }}" class="remove-item">Удалить</a>
                </li>
            {% endfor %}
        </ul>
        <div class="cart-total">
            <p><strong>Итого: {{ total_price | int}} ₽</strong></p>
        </div>
    {% else %}
        <p style="margin-left: 20px">Корзина пуста</p>
    {% endif %}
    <form method="POST" action="{{ url_for('make_order') }}">
    <button class="continue-shopping" id="open_pop_up">Купить</button>
</form>
    <a href="/" class="continue-shopping">Продолжить покупки</a>
<h2>Ожидание принятия заказа</h2>
{% for order in pending_orders %}
    <div class="order-block">
        <p>Заказ #{{ order.order_id }}</p>
        <ul>
            {% set cart = order.cart_data | from_json %}
            {% for item in cart.items %}
                <li>
                  <b>{{ item[1].name }}</b> — {{ item[1].description }}<br>
                  Цена: {{ item[1].price }} ₽ × {{ item[1].quantity }}
                </li>
            {% endfor %}
        </ul>
    </div>
{% endfor %}

<h2>Выполняются</h2>
{% for order in processing_orders %}
    <div>
        <p>Заказ #{{ order.order_id }} — В обработке</p>
        <!-- показать содержимое -->
    </div>
{% endfor %}
{% endblock %}